<#
.SYNOPSIS
    !! DISCOVERY SCRIPT !!
    Gets compliance CVE-2020-1350 status.
.DESCRIPTION
    Gets compliance CVE-2020-1350 status by checking if DNS service is present and TcpReceivePacketSize = 0xFF00.
.NOTES
    Created by Ioan Popovici
.LINK
    https://SCCM.Zone/
.LINK
    https://SCCM.Zone/GIT
.LINK
    https://SCCM.Zone/ISSUES
#>

Begin {
    ## Variable declaration
    [string]$Path = 'HKLM:\SYSTEM\CurrentControlSet\Services\DNS\Parameters'
    [string]$Value = '0xFF00'
    [bool]$ShouldProcess = If (Get-Service -Name 'DNS' -ErrorAction 'SilentlyContinue') { $true } Else { $false }
    [string]$Result = 'Compliant'
    $LastError = $null
}
Process {
    Try {
        If ($ShouldProcess) {
            [string]$KeyValue = '0x{0:x}' -f $(Get-ItemProperty -Path $Path -ErrorAction 'SilentlyContinue').TcpReceivePacketSize
            If ($KeyValue -ne $Value) { $Result = 'Non-Compliant' }
        }
    }
    Catch { $LastError = $($Error[0].Exception) }
    Finally {
        If ($LastError) { Write-Output -InputObject $LastError }
        Else { Write-Output -InputObject $Result }
    }
}
