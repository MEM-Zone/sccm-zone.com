<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="shortcut icon" href="/common/favicon.ico">
    
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
    <link rel="stylesheet" href="/common/site.css">
    
    
    <title>SCCM Zone :: SQL Server Product and Version Reporting with SCCM</title>
    <meta property="og:title"       content="SCCM Zone :: SQL Server Product and Version Reporting with SCCM" />
    <meta property="og:type"        content="article" />
    
    <meta property="og:url"         content="https://sccm-zone.com/posts/2019-07-18_sql-server-product-and-version-reporting-with-sccm/" />
    <meta property="og:description" content="" />
    
    
    
    
    
    
    
    
    
    
    <meta name="twitter:card"       content="summary" />
    
    
  </head>
  <body>
    <header class="navbar navbar-expand-lg navbar-dark bg-dark">
      
      <ul class="navbar-nav">
        
        
        
        
      </ul>
    </header>
    <nav class="navbar sticky-top navbar-expand-lg navbar-light bg-light">
      <a class="navbar-brand" href="https://sccm-zone.com">SCCM Zone</a>
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar_nav" aria-controls="navbar_nav" aria-expand="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbar_nav">
        
        <ul class="navbar-nav mr-auto">
          
          
          
          <li class="nav-item">
            <span class="nav-link disabled">Created At: 2019.07.18</span>
          </li>
          <li class="nav-item">
            <span class="nav-link disabled">Updated At: 2019.08.23</span>
          </li>
          
        </ul>
        
        <div class="navbar-nav ml-auto">
          <span class="navbar-text mr-1">share this page via</span>
          <ul class="navbar-nav">
            <li class="nav-item">
              <a class="nav-link" href="https://twitter.com/share?url=https%3a%2f%2fsccm-zone.com%2fposts%2f2019-07-18_sql-server-product-and-version-reporting-with-sccm%2f&text=SQL%20Server%20Product%20and%20Version%20Reporting%20with%20SCCM" target="_blank"><i class="fab fa-twitter"></i></a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="https://www.facebook.com/sharer.php?u=https%3a%2f%2fsccm-zone.com%2fposts%2f2019-07-18_sql-server-product-and-version-reporting-with-sccm%2f" target="_blank"><i class="fab fa-facebook"></i></a></a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="https://www.linkedin.com/shareArticle?url=https%3a%2f%2fsccm-zone.com%2fposts%2f2019-07-18_sql-server-product-and-version-reporting-with-sccm%2f&title=SQL%20Server%20Product%20and%20Version%20Reporting%20with%20SCCM" target="_blank"><i class="fab fa-linkedin"></i></a></a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="https://plusone.google.com/_/+1/confirm?url=https%3a%2f%2fsccm-zone.com%2fposts%2f2019-07-18_sql-server-product-and-version-reporting-with-sccm%2f" target="_blank"><i class="fab fa-google-plus"></i></a></a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="https://b.hatena.ne.jp/entry/https://sccm-zone.com/posts/2019-07-18_sql-server-product-and-version-reporting-with-sccm/" target="_blank">b!</a>
            </li>
          </ul>
        </div>
        
      </div>
    </nav>
    <main role="main" class="container-fluid col-lg-10 offset-lg-1">

<div class="row">
  <div class="col-lg-9">
    <article>
      <div class="row">
        <h1>SQL Server Product and Version Reporting with SCCM</h1>
      </div>
      

<p>SQL licensing is always a pain but this report should make it a little easier…</p>

<p><a href="https://SCCM.Zone/SW-SQL-Server-Products-CHANGELOG"><strong><em>Report release history</em></strong></a></p>

<p><a href="https://sccm-zone.com/sql-version-detection-and-report-sccm-2012-r2-12f299b5e63b"><strong><em>Previous report version</em></strong></a></p>

<p><a href="https://SCCM.Zone/SW-SQL-Server-Products-EXT"><strong><em>Originaly published on sccmf12twice.com</em></strong></a></p>

<p>This is the second iteration of my SQL version report. When I look back on my previous work I always cringe and this was no exception. A while back, I received a request to add the SQL key to the report, so I began examining the old code. Horrified by the things that I found laying dormant there, I scrapped everything and started anew. The result is a brand new report with a lot more info, smaller database footprint and much better coding.</p>

<h2 id="recommendations">Recommendations</h2>

<ul>
<li>Do not modify or remove the previous extension version until you thoroughly test the new version.<br /></li>
<li>Use a test environment for validation!<br /></li>
<li>Back-up your <a href="https://technet.microsoft.com/en-us/library/bb680858.aspx">configuration.mof</a> file before any changes!<br /></li>
<li>Use <a href="https://docs.microsoft.com/en-us/windows/win32/wmisdk/mofcomp">mofcomp.exe</a> to validate the <a href="https://technet.microsoft.com/en-us/library/bb680858.aspx">configuration.mof</a> on a test machine first!<br />
<br /></li>
</ul>

<blockquote>
<p><strong>Notes</strong><br />
This version is compatible with the previous version, they can live side by side.<br />
Hardware inventory extension needs to be done on the top of your hierarchy.</p>
</blockquote>

<h2 id="installation">Installation</h2>

<h3 id="prerequisites">Prerequisites</h3>

<ul>
<li>Test environment<br /></li>
<li>Downloads (Right click → Download linked file)<br />

<ul>
<li><a href="https://raw.githubusercontent.com/SCCM-Zone/sccm-zone.github.io/master/Reporting/Software/SW%20SQL%20Server%20Products/HWI%20EXT%20SQL%20Server%20Products.mof">HWI EXT SQL Server Products.mof</a> (HWI Extension)<br /></li>
<li><a href="https://raw.githubusercontent.com/SCCM-Zone/sccm-zone.github.io/master/Reporting/Software/SW%20SQL%20Server%20Products/HWI%20DEF%20SQL%20Server%20Products.mof">HWI DEF SQL Server Products.mof</a> (HWI Definitions)<br /></li>
<li><a href="https://raw.githubusercontent.com/SCCM-Zone/sccm-zone.github.io/master/Reporting/Software/SW%20SQL%20Server%20Products/SW%20SQL%20Server%20Products.rdl">SW SQL Server Products.rdl</a> (SSRS Report)<br /></li>
</ul></li>
<li>SQL Stored Procedure → <a href="Create-the-SQL-Stored-Procedure">Create the SQL Stored Procedure</a><br />
<br /></li>
</ul>

<h3 id="hwi-extension">HWI Extension</h3>

<p>The extension needs to be added to the <strong>&lt;CMInstallLocation&gt;\Inboxes\clifiles.src\hinv\configuration.mof</strong> file</p>

<ul>
<li><p>Insert the extension at the end of the <strong>configuration.mof</strong> file and between the following headers:</p>

<pre><code class="language-bash">//========================
// Added extensions start
//========================

//========================
// Added extensions end
//========================
</code></pre></li>

<li><p>Uncomment the &lsquo;<strong>Old SQL extension cleanup&rsquo;</strong> section to remove the old extension classes from the clients repositories if needed.</p></li>

<li><p>Use a test environment for validation as described in the <a href="#test-and-validation">Test and Validation</a> section.</p></li>
</ul>

<blockquote>
<p><strong>Notes</strong><br />
Always use a test environment before any changes in production!<br />
Never create any extensions outside of the “Added extensions start/end” headers.<br />
Try to have consistent formatting inside these headers.<br />
Never modify anything outside these headers.<br />
Watch for other previous extensions and use clear delimitation between them.</p>
</blockquote>

<h3 id="apply-changes">Apply changes</h3>

<p>Compiling the configuration.mof file in the hinv folder on the CAS/PSS, will trigger the distribution and compilation on all machines in your environment on the next machine policy evaluation.</p>

<pre><code class="language-bash">mofcomp.exe &lt;CMInstallLocation&gt;\Inboxes\clifiles.src\hinv\Configuration.mof
</code></pre>

<p><img src="/uploads/2.png" alt="image" /></p>

<p>Implement HWI extension in production</p>

<h3 id="hwi-definitions">HWI Definitions</h3>

<p>You need to add the new class definitions to the Default Client Settings</p>

<ul>
<li>Import definitions.<br />
<br /></li>
</ul>

<p><img src="/uploads/3.png" alt="image" /></p>

<p>Click on Import and select the <strong>HWI DEF SQL Server Products.mof</strong> file</p>

<p><img src="/uploads/4.png" alt="image" /></p>

<p>Review the classes and click on Import.</p>

<p><img src="/uploads/5.png" alt="image" /></p>

<p>Make sure the new extension classes are enabled and click OK</p>

<blockquote>
<p><strong>Notes</strong><br />
DO NOT DELETE the old extension definitions if you still want to use the old report!</p>
</blockquote>

<h2 id="test-and-validation">Test and Validation</h2>

<h3 id="configuration-mof">Configuration.mof</h3>

<p>Use <a href="https://docs.microsoft.com/en-us/windows/win32/wmisdk/mofcomp"><strong><em>mofcomp.exe</em></strong></a> to check if <a href="https://technet.microsoft.com/en-us/library/bb680858.aspx"><strong><em>configuration.mof</em></strong></a> was correctly modified and implement the changes.</p>

<pre><code class="language-powershell">## Check syntax
mofcomp.exe -check &lt;Configuration.mof_Directory&gt;\Configuration.mof

## Compile file
/*
Compiling the configuration.mof file in the hinv folder on the CAS/PSS,
will trigger the distribution and compilation on all machines in your
environment on the next machine policy evaluation.
*/

mofcomp.exe &lt;Configuration.mof_Directory&gt;\Configuration.mof
</code></pre>

<p><img src="/uploads/6.png" alt="image" /></p>

<p>Compling the configuration.mof is done on a test environment here!</p>

<blockquote>
<p><strong>Notes</strong><br />
Saving and compiling the configuration.mof file in the hinv folder on the CAS/PSS, will trigger the distribution and compilation on all machines in your environment on the next machine policy evaluation.</p>
</blockquote>

<h3 id="wmi">WMI</h3>

<p>Use PowerShell to check if the new classes have been created in WMI</p>

<pre><code class="language-powershell">## Check if the new classes are present in WMI
/* The machine must have at least one version of SQL installed in
order for these classes to be created */

#  Get SQL 2017 class
Get-CimClass -ClassName SQL_2017_Property

#  Get SQL 2014 class
Get-CimClass -ClassName SQL_2014_Property

#  Get SQL 2012 class
Get-CimClass -ClassName SQL_2012_Property

#  Get SQL 2008 class
Get-CimClass -ClassName SQL_2008_Property

#  Get SQL Legacy class
Get-CimClass -ClassName SQL_Legacy_Property

#  Get SQL ProductID class
Get-CimClass -ClassName SQL_ProductID
</code></pre>

<h3 id="database">Database</h3>

<p>Use SSMS (SQL Server Management Studio) to check if the views are created in the CM database</p>

<p><img src="/uploads/7.png" alt="image" /></p>

<h2 id="import-the-ssrs-report">Import the SSRS Report</h2>

<h3 id="upload-report-to-ssrs">Upload Report to SSRS</h3>

<ul>
<li>Start Internet Explorer and navigate to <a href="http://en.wikipedia.org/wiki/Fully_qualified_domain_name"><strong>http://&lt;YOUR_REPORT_SERVER_FQDN&gt;Reports</strong></a><br /></li>
<li>Choose a path and upload the previously downloaded report file.<br />
<br /></li>
</ul>

<h3 id="configure-imported-report">Configure Imported Report</h3>

<ul>
<li><a href="https://joshheffner.com/how-to-import-additional-software-update-reports-in-sccm/"><strong><em>Replace the DataSource</em></strong></a> in the report.<br />
<br /></li>
</ul>

<h2 id="create-the-sql-stored-procedure">Create the SQL Stored Procedure</h2>

<p>The usp_PivotWithDynamicColumns is needed in order to maximize code reuse and have a more sane and sanitized data source.</p>

<ul>
<li>Copy paste the code below in SSMS<br /></li>
<li>Change the <strong>&lt;SITE_CODE&gt;</strong> in the <strong>USE</strong> statement to match your Site Code.<br /></li>
<li>Click <strong>Execute</strong> to add the <a href="#vb-support-function"><strong>_usp<em>PivotWithDynamicColumns</em></strong></a> stored procedure to your database.<br />
<br /></li>
</ul>

<blockquote>
<p><strong>Notes</strong><br />
<strong>You might need additional DB access to install the support function!</strong><br />
<strong>Allow</strong> some time for the policy to be downloaded or force a policy refresh.<br />
<strong>Allow</strong> some time for the data to be gathered or force a HWI collection.<br />
This report was created with SQL 2017 Reporting Services, you might need to remove some report elements if you use an older version.</p>
</blockquote>

<h2 id="preview">Preview</h2>

<p><img src="/uploads/8.png" alt="image" title="Report preview" /></p>

<h2 id="code">Code</h2>

<h3 id="extension">Extension</h3>

<p>For reference only, you can download the file in the <a href="#prerequisites"><strong>Prerequisites</strong></a> section.</p>

<h3 id="definitions">Definitions</h3>

<p>For reference only, you can download the file in the <a href="#prerequisites"><strong>Prerequisites</strong></a> section.</p>

<h3 id="sql-query">SQL Query</h3>

<p>For reference only, the report includes this query.</p>

<h3 id="vb-support-function">VB Support Function</h3>

<p>For reference only, the report includes this function.</p>

<script src="https://embed.cacher.io/83576ed10a66f816abf812925f284fa17d58fc14.js?a=dac2e390b609c7b9b8c4f97ff5b0a4cc&t=atom_one_dark&r=0"></script>

<script src="https://gist.github.com/Ioan-Popovici/db8228de1d96def7a455fdbf1b59f165.js"></script>

<blockquote>
<p><strong>Notes</strong><br />
Credit to Jakob Bindslet and Chrissy LeMaire.</p>
</blockquote>

<hr />

<p><center><img src="/uploads/9.gif" alt="image" title="Random gif" /></center></p>

<hr />

<h2 id="please-use-github-http-sccm-zone-git-for-reporting-or-and-requests">Please use <a href="http://SCCM.Zone/GIT">Github</a> for 🐛 reporting, or 🌈 and 🦄 requests</h2>

    </article>
  </div>
  <div class="col-lg-3">
    <div class="sidebar">
  
  <hr />
  <h4>TableOfContents</h4>
  <nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#recommendations">Recommendations</a></li>
<li><a href="#installation">Installation</a>
<ul>
<li><a href="#prerequisites">Prerequisites</a></li>
<li><a href="#hwi-extension">HWI Extension</a></li>
<li><a href="#apply-changes">Apply changes</a></li>
<li><a href="#hwi-definitions">HWI Definitions</a></li>
</ul></li>
<li><a href="#test-and-validation">Test and Validation</a>
<ul>
<li><a href="#configuration-mof">Configuration.mof</a></li>
<li><a href="#wmi">WMI</a></li>
<li><a href="#database">Database</a></li>
</ul></li>
<li><a href="#import-the-ssrs-report">Import the SSRS Report</a>
<ul>
<li><a href="#upload-report-to-ssrs">Upload Report to SSRS</a></li>
<li><a href="#configure-imported-report">Configure Imported Report</a></li>
</ul></li>
<li><a href="#create-the-sql-stored-procedure">Create the SQL Stored Procedure</a></li>
<li><a href="#preview">Preview</a></li>
<li><a href="#code">Code</a>
<ul>
<li><a href="#extension">Extension</a></li>
<li><a href="#definitions">Definitions</a></li>
<li><a href="#sql-query">SQL Query</a></li>
<li><a href="#vb-support-function">VB Support Function</a></li>
</ul></li>
<li><a href="#please-use-github-http-sccm-zone-git-for-reporting-or-and-requests">Please use <a href="http://SCCM.Zone/GIT">Github</a> for 🐛 reporting, or 🌈 and 🦄 requests</a></li>
</ul></li>
</ul>
</nav>
  <hr />
  <h4><a href="/categories/">Categories</a></h4>
  
  <hr />
  <h4><a href="/tags/">Tags</a></h4>
  
</div>

  </div>
</div>
      <div class="row">
        <footer class="col-lg-12">
          <hr/>
          <span>&copy; SCCM Zone</span>
          <span>&nbsp;&middot;&nbsp;</span>
          <i class="fas fa-bolt"></i>
          <span>Powered by <a href="https://gohugo.io/" target="_blank">Hugo</a></span>
        </footer>
      </div>
    </div>
    </main>
    
      
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
    
    <script defer src="https://use.fontawesome.com/releases/v5.0.8/js/all.js" integrity="sha384-SlE991lGASHoBfWbelyBPLsUlwY1GwNDJo3jSJO04KZ33K2bwfV9YBauFfnzvynJ" crossorigin="anonymous"></script>
    
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}
      });
    </script>
  </body>
</html>

